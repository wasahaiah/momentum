"use strict";(globalThis.webpackChunkmomentum_website=globalThis.webpackChunkmomentum_website||[]).push([[5680],{94762:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"developer_guide/style_guide","title":"Style Guide","description":"Momentum adheres to the following upstream standards, except when explicitly mentioned to override specific items:","source":"@site/docs_cpp/04_developer_guide/02_style_guide.md","sourceDirName":"04_developer_guide","slug":"/developer_guide/style_guide","permalink":"/momentum/docs/developer_guide/style_guide","draft":false,"unlisted":false,"editUrl":"https://github.com/facebookresearch/momentum/edit/main/momentum/website/docs_cpp/04_developer_guide/02_style_guide.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Development Environment","permalink":"/momentum/docs/developer_guide/development_environment"}}');var r=s(74848),i=s(28453);const o={sidebar_position:2},a="Style Guide",l={},c=[{value:"Code Formatting",id:"code-formatting",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Alternative Approaches",id:"alternative-approaches",level:3},{value:"std::options",id:"stdoptions",level:4},{value:"folly::Expected",id:"follyexpected",level:4},{value:"Array Access",id:"array-access",level:3},{value:"Design Decisions",id:"design-decisions",level:2},{value:"Prefer <code>std::span</code> over typed container like <code>std::vector</code> as function argument",id:"prefer-stdspan-over-typed-container-like-stdvector-as-function-argument",level:3},{value:"Header Include Style",id:"header-include-style",level:3},{value:"Public Headers (Use Angle Brackets <code>&lt;&gt;</code>)",id:"public-headers-use-angle-brackets-",level:4},{value:"Library Implementation Source Files (Use Quotes <code>&quot;&quot;</code>)",id:"library-implementation-source-files-use-quotes-",level:4},{value:"Tests, Tutorials, and Examples (Use Angle Brackets <code>&lt;&gt;</code>)",id:"tests-tutorials-and-examples-use-angle-brackets-",level:4}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components},{FbInternalOnly:s,OssOnly:t}=n;return s||p("FbInternalOnly",!0),t||p("OssOnly",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"style-guide",children:"Style Guide"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)(n.p,{children:"Momentum adheres to the following upstream standards, except when explicitly mentioned to override specific items:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.internalfb.com/intern/wiki/Cpp/CppCodingConventions/",children:"Meta's C++ Coding Conventions"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.internalfb.com/intern/wiki/Cpp/CppStyle/",children:"Meta's C++ Style Guide"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.internalfb.com/intern/wiki/C++_Common_Pitfalls_and_Best_Practices/",children:"Common Pitfalls"})}),"\n"]})]}),"\n",(0,r.jsx)(t,{children:(0,r.jsx)(n.p,{children:"Momentum adheres to specific coding conventions and style guidelines that are based on internal standards developed by Meta. While these specific documents are not publicly accessible, we encourage external developers to follow general best practices in C++ programming to ensure code quality and maintainability."})}),"\n",(0,r.jsx)(n.h2,{id:"code-formatting",children:"Code Formatting"}),"\n",(0,r.jsx)(n.p,{children:"To format your code, run:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pixi run lint\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This uses ",(0,r.jsx)(n.code,{children:"clang-format"})," with the specific version defined in ",(0,r.jsx)(n.code,{children:"pixi.toml"})," to ensure consistent formatting across all C++ source files."]}),"\n",(0,r.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,r.jsx)(n.p,{children:"Momentum uses exceptions for handling unrecoverable errors, which is essential for a lower-level library like this. Throwing exceptions allows error detection mechanisms to have visibility into these errors and prevents silent failures, which may lead to more severe bugs. By choosing exceptions as the primary method for error handling in Momentum, we ensure that unrecoverable errors are easily detectable, and the Momentum library remains user-friendly for developers interacting with the application layer."}),"\n",(0,r.jsx)(n.p,{children:"Using exceptions is especially crucial when considering the application layer as the user of the Momentum library. For layers closer to the services, everything should be surrounded by try-catch blocks to prevent server crashes while still providing valuable error information. Python programmers, who often interact with the application layer, typically expect exceptions, making it a more reasonable approach for error handling in Momentum."}),"\n",(0,r.jsxs)(n.p,{children:["One important caution is to avoid using exceptions for flow control; common errors, such as ",'"',(0,r.jsx)(n.a,{href:"https://internalfb.com/L2",children:"L2"})," ",'norm is too high," should not result in exceptions being thrown.']}),"\n",(0,r.jsx)(n.h3,{id:"alternative-approaches",children:"Alternative Approaches"}),"\n",(0,r.jsx)(n.h4,{id:"stdoptions",children:"std::options"}),"\n",(0,r.jsx)(n.p,{children:"While optional types can be acceptable in some cases, they can lead to the loss of error information, which is not ideal for the application layer. We use optional types for inputs that can be missing for a few frames due to reasons such as lost tracking, but in these cases, the specific reason is not critical."}),"\n",(0,r.jsx)(n.h4,{id:"follyexpected",children:"folly::Expected"}),"\n",(0,r.jsxs)(n.p,{children:["Folly::Expected acts like an optional type but allows for an error type to be specified (see documentation ",(0,r.jsx)(n.a,{href:"https://www.internalfb.com/code/fbsource/%5B84b294fbc7bb1d3a90efcdd440a9d7a4d9f83222%5D/xplat/folly/Expected.h?lines=818",children:"here"}),"). This can be useful in some APIs, particularly if error codes need to be serialized or for other similar purposes. In general, folly::Expected is preferred over std::optional."]}),"\n",(0,r.jsx)(n.h3,{id:"array-access",children:"Array Access"}),"\n",(0,r.jsxs)(n.p,{children:["When accessing elements within arrays, the Momentum codebase employs two methods: the ",(0,r.jsx)(n.code,{children:".at()"})," method and the ",(0,r.jsx)(n.code,{children:"[]"})," operator. The choice between these two methods should be made based on the considerations of performance, safety, and the intended audience of the code:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["It is recommended to use the ",(0,r.jsx)(n.code,{children:"[]"})," operator for code that is self-contained and developed by the Momentum team, especially for low-level and performance-critical code. The ",(0,r.jsx)(n.code,{children:"[]"})," operator does not perform bounds checking, thus offering better performance."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Conversely, the ",(0,r.jsx)(n.code,{children:".at()"})," method should be considered for areas of code that might be accessed by the user as it performs bounds checking to prevent out-of-range errors, enhancing the safety of the code."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"design-decisions",children:"Design Decisions"}),"\n",(0,r.jsxs)(n.h3,{id:"prefer-stdspan-over-typed-container-like-stdvector-as-function-argument",children:["Prefer ",(0,r.jsx)(n.code,{children:"std::span"})," over typed container like ",(0,r.jsx)(n.code,{children:"std::vector"})," as function argument"]}),"\n",(0,r.jsxs)(n.p,{children:["Using ",(0,r.jsx)(n.code,{children:"std::vector<T>"})," as a function argument requires the call site to create an ",(0,r.jsx)(n.code,{children:"std::vector<T>"})," instance even when the data is already stored in a compatible memory layout, such as contiguous memory. By switching to ",(0,r.jsx)(n.code,{children:"std::span<T>"}),", call sites can avoid creating an additional ",(0,r.jsx)(n.code,{children:"std::vector<T>"})," object and benefit from improved performance by not requiring an unnecessary data copy."]}),"\n",(0,r.jsx)(n.h3,{id:"header-include-style",children:"Header Include Style"}),"\n",(0,r.jsx)(n.p,{children:"Momentum follows standard C++ conventions for header includes, using different syntax depending on the context:"}),"\n",(0,r.jsxs)(n.h4,{id:"public-headers-use-angle-brackets-",children:["Public Headers (Use Angle Brackets ",(0,r.jsx)(n.code,{children:"<>"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["In ",(0,r.jsx)(n.strong,{children:"public Momentum headers"})," that are installed for users, use angle brackets:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"// In public header files (e.g., momentum/character/character.h)\n#include <momentum/common/checks.h>\n#include <momentum/math/mesh.h>\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Rationale"}),": Angle brackets instruct the compiler to search in system/standard include paths. When Momentum is installed as a library, downstream users and build systems will treat these as system headers and look for them in the appropriate system locations (e.g., ",(0,r.jsx)(n.code,{children:"/usr/local/include"}),", ",(0,r.jsx)(n.code,{children:"/opt/include"}),")."]}),"\n",(0,r.jsxs)(n.h4,{id:"library-implementation-source-files-use-quotes-",children:["Library Implementation Source Files (Use Quotes ",(0,r.jsx)(n.code,{children:'""'}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["In ",(0,r.jsx)(n.strong,{children:"library implementation source files"})," (",(0,r.jsx)(n.code,{children:".cpp"})," files in core library directories), use quotes:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:'// In library implementation .cpp files\n#include "momentum/character/character.h"\n#include "momentum/common/checks.h"\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Rationale"}),": Quotes instruct the compiler to first search in local/relative directories before falling back to system paths. This ensures that during Momentum's own build process, the compiler finds the local development headers rather than any previously installed system versions."]}),"\n",(0,r.jsxs)(n.h4,{id:"tests-tutorials-and-examples-use-angle-brackets-",children:["Tests, Tutorials, and Examples (Use Angle Brackets ",(0,r.jsx)(n.code,{children:"<>"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["In ",(0,r.jsx)(n.strong,{children:"tests, tutorials, and example code"}),", use angle brackets:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"// In test files, tutorials, and examples\n#include <momentum/character/character.h>\n#include <momentum/common/checks.h>\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Rationale"}),": Tests, tutorials, and examples represent user-facing code that demonstrates how external developers should consume the Momentum library. They should mirror the external user experience by using angle brackets as users would when the library is installed as a system library. This also serves as documentation showing the correct way to include headers."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}function p(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}}}]);