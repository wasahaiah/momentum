"use strict";(globalThis.webpackChunkmomentum_website=globalThis.webpackChunkmomentum_website||[]).push([[373],{84123:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"developer_guide/conda_publishing","title":"Conda Package Management","description":"This guide explains how PyMomentum conda packages are managed and published to conda-forge.","source":"@site/docs_python/03_developer_guide/04_conda_publishing.md","sourceDirName":"03_developer_guide","slug":"/developer_guide/conda_publishing","permalink":"/momentum/pymomentum/developer_guide/conda_publishing","draft":false,"unlisted":false,"editUrl":"https://github.com/facebookresearch/momentum/edit/main/momentum/website/docs_python/03_developer_guide/04_conda_publishing.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"PyPI Publishing Guide","permalink":"/momentum/pymomentum/developer_guide/pypi_publishing"}}');var r=i(74848),o=i(28453);const d={},c="Conda Package Management",l={},t=[{value:"Overview",id:"overview",level:2},{value:"How It Works",id:"how-it-works",level:2},{value:"1. Release Process",id:"1-release-process",level:3},{value:"2. Feedstock Structure",id:"2-feedstock-structure",level:3},{value:"3. Version and Dependency Management",id:"3-version-and-dependency-management",level:3},{value:"PyTorch and CUDA Pinning",id:"pytorch-and-cuda-pinning",level:4},{value:"Adding Support for Older Dependencies",id:"adding-support-for-older-dependencies",level:4},{value:"Updating the Feedstock",id:"updating-the-feedstock",level:2},{value:"When to Update",id:"when-to-update",level:3},{value:"Making Changes",id:"making-changes",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Finding Package Details",id:"finding-package-details",level:3},{value:"Installing Specific Versions",id:"installing-specific-versions",level:3},{value:"Build Failures",id:"build-failures",level:3},{value:"Dependency Conflicts",id:"dependency-conflicts",level:3},{value:"Alternative: Building from Source",id:"alternative-building-from-source",level:2},{value:"Contributing",id:"contributing",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components},{FbInternalOnly:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("FbInternalOnly",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"conda-package-management",children:"Conda Package Management"})}),"\n",(0,r.jsx)(n.p,{children:"This guide explains how PyMomentum conda packages are managed and published to conda-forge."}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:["PyMomentum is available on ",(0,r.jsx)(n.a,{href:"https://conda-forge.org/",children:"conda-forge"}),", making it accessible through conda, mamba, pixi, and other conda-compatible package managers. The package is automatically built and published for multiple platforms (Linux, macOS, Windows) with support for both CPU and CUDA-accelerated variants."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Key Resources:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Package Browser"}),": ",(0,r.jsx)(n.a,{href:"https://prefix.dev/channels/conda-forge/packages/pymomentum",children:"prefix.dev/channels/conda-forge/packages/pymomentum"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Recipe Repository"}),": ",(0,r.jsx)(n.a,{href:"https://github.com/conda-forge/momentum-feedstock",children:"conda-forge/momentum-feedstock"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Anaconda Repository"}),": ",(0,r.jsx)(n.a,{href:"https://anaconda.org/conda-forge/momentum",children:"anaconda.org/conda-forge/momentum"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,r.jsx)(n.h3,{id:"1-release-process",children:"1. Release Process"}),"\n",(0,r.jsx)(n.p,{children:"When a new version is released:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Git Tag"}),": Repository maintainers manually create and push a tag matching ",(0,r.jsx)(n.code,{children:"v*"})," pattern (e.g., ",(0,r.jsx)(n.code,{children:"v0.2.0"}),") to the main repository","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Tags are typically created weekly or more frequently when requested"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Automated PR"}),": conda-forge's bot detects the new tag and creates a PR in the ",(0,r.jsx)(n.a,{href:"https://github.com/conda-forge/momentum-feedstock",children:"momentum-feedstock"})," repository"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Build & Test"}),": CI builds packages for all supported platforms and runs tests"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Merge"}),": After approval, the PR is merged and packages are published to conda-forge"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Availability"}),": Users can install via ",(0,r.jsx)(n.code,{children:"conda install -c conda-forge pymomentum"})," within hours"]}),"\n"]}),"\n",(0,r.jsx)(i,{children:(0,r.jsx)(n.p,{children:"Tags are created directly on the public GitHub repository by the maintainers. They are not synced from the internal codebase. Contact the repository maintainers if you need a release tag created."})}),"\n",(0,r.jsx)(n.h3,{id:"2-feedstock-structure",children:"2. Feedstock Structure"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.a,{href:"https://github.com/conda-forge/momentum-feedstock",children:"momentum-feedstock"})," contains:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"recipe/meta.yaml"})}),": Package metadata, dependencies, build configurations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"recipe/build.sh"})}),": Unix build script (Linux/macOS)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"recipe/bld.bat"})}),": Windows build script"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:".ci_support/"})}),": Platform-specific build configurations (PyTorch, CUDA versions, etc.)","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Auto-generated by conda-smithy when running ",(0,r.jsx)(n.code,{children:"conda smithy rerender"}),' locally or commenting "@conda-forge-admin, please rerender" on PRs']}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-version-and-dependency-management",children:"3. Version and Dependency Management"}),"\n",(0,r.jsx)(n.h4,{id:"pytorch-and-cuda-pinning",children:"PyTorch and CUDA Pinning"}),"\n",(0,r.jsxs)(n.p,{children:["conda-forge uses ",(0,r.jsx)(n.strong,{children:"global pinning"})," to ensure compatible versions across the ecosystem:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"PyTorch versions"}),": Managed in ",(0,r.jsx)(n.a,{href:"https://github.com/conda-forge/conda-forge-pinning-feedstock",children:"conda-forge-pinning-feedstock"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CUDA versions"}),': Also globally pinned to avoid "dependency islands"']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"PyMomentum"}),": Automatically builds against all pinned PyTorch/CUDA combinations"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example"}),": If conda-forge supports PyTorch 2.8 with CUDA 12.9 and 12.6, momentum-feedstock automatically builds:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"pymomentum-0.2.0-cuda129_py312_*"})," (PyTorch 2.8 + CUDA 12.9 + Python 3.12)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"pymomentum-0.2.0-cuda126_py312_*"})," (PyTorch 2.8 + CUDA 12.6 + Python 3.12)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"pymomentum-0.2.0-cpu_py312_*"})," (PyTorch 2.8 CPU + Python 3.12)"]}),"\n",(0,r.jsx)(n.li,{children:"... and more combinations for different Python versions and platforms"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"adding-support-for-older-dependencies",children:"Adding Support for Older Dependencies"}),"\n",(0,r.jsx)(n.p,{children:"If you need an older CUDA or PyTorch version not currently supported:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Read conda-forge documentation"})," on ",(0,r.jsx)(n.a,{href:"https://conda-forge.org/docs/maintainer/knowledge_base.html#pinning-and-build-matrices",children:"pinning and build matrices"})," to understand how to configure version combinations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Update ",(0,r.jsx)(n.code,{children:"recipe/conda_build_config.yaml"})]})," (if needed) to specify version constraints"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Run rerender"}),": The ",(0,r.jsx)(n.code,{children:".ci_support/"})," files are automatically generated by conda-smithy"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Submit PR"})," to ",(0,r.jsx)(n.a,{href:"https://github.com/conda-forge/momentum-feedstock",children:"momentum-feedstock"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Example PR"}),": ",(0,r.jsx)(n.a,{href:"https://github.com/conda-forge/momentum-feedstock/pull/171",children:"Supporting CUDA 12.6"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Since momentum-feedstock is open source, community contributions are welcome!"}),"\n",(0,r.jsx)(n.h2,{id:"updating-the-feedstock",children:"Updating the Feedstock"}),"\n",(0,r.jsx)(n.h3,{id:"when-to-update",children:"When to Update"}),"\n",(0,r.jsx)(n.p,{children:"You typically need to update the feedstock when:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"New release"}),": Automated bot creates PR (usually no manual intervention needed)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Build fixes"}),": Fixing build failures on specific platforms"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Dependency updates"}),": Adding support for new PyTorch/CUDA versions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Platform support"}),": Adding new OS or architecture support"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"making-changes",children:"Making Changes"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Fork"})," the ",(0,r.jsx)(n.a,{href:"https://github.com/conda-forge/momentum-feedstock",children:"momentum-feedstock"})," repository"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Update recipe"}),": Modify ",(0,r.jsx)(n.code,{children:"recipe/meta.yaml"})," or build scripts"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test locally"})," (optional but recommended):","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Install conda-build\nconda install conda-build\n\n# Build locally\nconda build recipe/\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Create PR"}),": Submit to momentum-feedstock"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CI Review"}),": conda-forge CI automatically tests all platforms"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Merge"}),": After approval, packages are published"]}),"\n"]}),"\n",(0,r.jsxs)(i,{children:[(0,r.jsx)(n.p,{children:"For internal changes to the upstream momentum repository that affect conda builds (e.g., CMake changes, dependency updates), ensure you coordinate with the momentum-feedstock maintainers to update the recipe accordingly. The feedstock typically needs updates when:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"CMake build flags change"}),"\n",(0,r.jsx)(n.li,{children:"New required dependencies are added"}),"\n",(0,r.jsx)(n.li,{children:"Build system changes (e.g., scikit-build-core updates)"}),"\n"]})]}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"finding-package-details",children:"Finding Package Details"}),"\n",(0,r.jsxs)(n.p,{children:["Inspect installed files and metadata for any package version using ",(0,r.jsx)(n.a,{href:"https://conda-metadata-app.streamlit.app/?q=conda-forge/linux-64/pymomentum-0.1.77-cuda129_py313_h861d01a_0.conda",children:"conda-metadata-app"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Or locally:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Show package info\nconda info pymomentum\n\n# List installed files\nconda list pymomentum --show-channel-urls\n"})}),"\n",(0,r.jsx)(n.h3,{id:"installing-specific-versions",children:"Installing Specific Versions"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Install specific version\nconda install -c conda-forge pymomentum=0.1.77\n\n# Install specific version with CUDA constraint\nconda install -c conda-forge "pymomentum=0.1.77=cuda129*"\n\n# Install specific Python version\nconda install -c conda-forge "pymomentum=0.1.77=*py312*"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"build-failures",children:"Build Failures"}),"\n",(0,r.jsx)(n.p,{children:"If conda builds fail:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Check CI logs"})," in the feedstock PR"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test locally"})," with ",(0,r.jsx)(n.code,{children:"conda build recipe/"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Check dependency availability"}),": Ensure PyTorch/CUDA versions exist on conda-forge"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Review recent changes"}),": Check if upstream momentum changes broke the build"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"dependency-conflicts",children:"Dependency Conflicts"}),"\n",(0,r.jsx)(n.p,{children:"If users report dependency conflicts:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Verify pinning"}),": Check ",(0,r.jsx)(n.a,{href:"https://github.com/conda-forge/conda-forge-pinning-feedstock",children:"conda-forge-pinning-feedstock"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Update constraints"}),": Relax version constraints in ",(0,r.jsx)(n.code,{children:"recipe/meta.yaml"})," if too strict"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test resolution"}),": Use ",(0,r.jsx)(n.code,{children:"conda-tree"})," or ",(0,r.jsx)(n.code,{children:"pixi tree"})," to visualize dependency graphs"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"alternative-building-from-source",children:"Alternative: Building from Source"}),"\n",(0,r.jsx)(n.p,{children:"If conda packages don't meet your requirements (e.g., custom PyTorch build, unreleased CUDA version), you can:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Clone momentum"}),": ",(0,r.jsx)(n.code,{children:"git clone https://github.com/facebookresearch/momentum"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Setup environment"}),": ",(0,r.jsx)(n.code,{children:"pixi install"})," or create custom conda environment"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Build"}),": ",(0,r.jsx)(n.code,{children:"pip install ."})," (see ",(0,r.jsx)(n.a,{href:"/momentum/pymomentum/user_guide/getting_started#building-from-source-for-custom-environments",children:"Getting Started"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This gives you full control over dependency versions at the cost of manual maintenance."}),"\n",(0,r.jsx)(n.h2,{id:"contributing",children:"Contributing"}),"\n",(0,r.jsx)(n.p,{children:"We welcome contributions to improve conda packaging! Areas where help is appreciated:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Platform support"}),": Adding ARM64 Linux, new OS versions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Dependency backports"}),": Supporting older PyTorch/CUDA for legacy systems"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Build optimizations"}),": Reducing package size, improving build times"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Documentation"}),": Clarifying build procedures, troubleshooting guides"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Submit PRs to ",(0,r.jsx)(n.a,{href:"https://github.com/conda-forge/momentum-feedstock",children:"momentum-feedstock"})," or open issues for discussion."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);